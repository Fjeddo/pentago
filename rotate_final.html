<html>
    <head>
        <style>
            #b { width: 500; margin: auto; transform-origin: 50% 50%; }
            
        </style>
        
    </head>
    <body>
        <div id="b">
            <svg width="500" height="500" id="a" class="quad">
                
                <rect width="300" height="300" x="100" y="100" fill="blue"></rect>
                <circle id="c" width="100" height="100" cx="150" cy="150" r="40" fill="cyan"></circle>
                
            </svg>
        </div>
        <p id="demo"></p>
        
        <script>
            var dragging = false;

            var startingMouseAngle = {};

            var box; // = document.getElementById("a");

            var boxCenter = {}; /* = {
                x: box.getAttribute("width") / 2,
                y: box.getAttribute("height") / 2
            } */

            /*
            Future note:
            getElementsByClassName is an array-like object, will have to loop through it to assign
            everything inside an event listener (like below)
            */

            document.getElementById("a").addEventListener("mousedown", function(ev) {
                dragging = true;
                if (ev.preventDefault) { // prevent firefox image dragging
                    ev.preventDefault();
                }
                //ev.stopPropagation();
                box = ev.target.parentElement;
                var field = box.getBoundingClientRect();
                boxCenter = {
                    x: (box.getAttribute("width") / 2) + field.left,
                    y: (box.getAttribute("height") / 2) + field.top
                }
                // get starting mouse coordinates on click
                startMouseCoords = {
                        x: ev.clientX,
                        y: ev.clientY
                }
            });

            document.addEventListener("mousemove", function(ev) {
                if (dragging) {
                    // get current mouse coordinates on drag
                    var field = box.getBoundingClientRect();
                    var currentMouseCoords = {
                        x: ev.clientX,// - field.left,
                        y: ev.clientY// - field.top
                    }

                    /*
                    if ( startMouseCoords.x < field.left || startMouseCoords.x > field.right || 
                        startMouseCoords.y < field.top || startMouseCoords.y > field.bottom ) {
                        document.querySelector(".trigger").onclick()
                    }*/

                    var finalDegree;
                    if ( currentMouseCoords.x !== startMouseCoords.x && currentMouseCoords.y !== startMouseCoords.y ) {
                        var startDegree = Math.atan2( currentMouseCoords.y - boxCenter.y, currentMouseCoords.x - boxCenter.x );
                        startDegree -= Math.atan2( startMouseCoords.y - boxCenter.y, startMouseCoords.x - boxCenter.x );
                        finalDegree = (startDegree * (360 / (2 * Math.PI)));
                    }

                    
                    if (finalDegree > 90 && finalDegree < 180) {
                        finalDegree = 90;
                        dragging = false;
                    }

                    if (finalDegree < 270 && finalDegree > 180 ) {
                        finalDegree = 270;
                        dragging = false;
                    }
                    
                    if (finalDegree < -90 && finalDegree > -180) {
                        finalDegree = -90;
                        dragging = false;
                    }

                    if (finalDegree > -270 && finalDegree < -180 ) {
                        finalDegree = -270;
                        dragging = false;
                    }

                    var coords = "start X: " + startMouseCoords.x + "<br>start Y: " + startMouseCoords.y + "<br>Start Degree: " + startDegree
                        + "<br>current X: " + currentMouseCoords.x + "<br>current Y: " + currentMouseCoords.y + "<br>Final Degree: " + finalDegree + 
                        "<br>box X: " + boxCenter.x + "<br>box Y: " + boxCenter.y;
                    document.getElementById("demo").innerHTML = coords;

                    box.style.transform = "rotate(" + finalDegree + "deg)";
                }
            });

            document.addEventListener("mouseup", function() {
                endingSnap();
            });

            function endingSnap() {
                dragging = false;
                box.style.transform = "rotate(0deg)";
            }

        </script>
    </body>
</html>
